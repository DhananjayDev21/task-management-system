<div class="main-container">
    <div class="header-section">
        <div class="header-title">
            <h1>Task Analytics</h1>
            <div class="header-stats">
                <span class="filtered-tasks" aria-live="polite">{{ filteredData.length }} Showing</span>
            </div>
        </div>
    </div>

    <div class="filter-panel" aria-label="Filter controls">
        <div class="filter-header">
            <div class="filter-title">
                <span class="filter-icon"><i class="fas fa-filter" aria-hidden="true"></i></span>
                <h2>Filters</h2>
                <span class="filter-count" aria-live="polite">{{ activeFilterCount }} active</span>
            </div>
            <div class="quick-actions">
                <div class="filter-notice" *ngIf="hasUnappliedChanges" role="alert">
                    <span class="notice-icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span>
                    <span class="notice-text">Unapplied changes</span>
                </div>
            </div>
        </div>

        <form class="filters-grid" (ngSubmit)="applyFilters()" aria-label="Task filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="searchText" class="filter-label">Search</label>
                    <div class="search-container">
                        <span class="search-icon"><i class="fas fa-search" aria-hidden="true"></i></span>
                        <input id="searchText" type="text" class="filter-input search-input"
                            [(ngModel)]="filters.searchText" name="searchText" (ngModelChange)="onFilterChange()"
                            placeholder="Search tasks..." autocomplete="off" aria-describedby="searchText" />
                    </div>
                </div>

                <div class="filter-group">
                    <label for="status" class="filter-label">Status</label>
                    <div class="select-container">
                        <select id="status" [(ngModel)]="filters.status" name="status"
                            (ngModelChange)="onFilterChange()" class="filter-select" aria-describedby="status">
                            <option value="">All Statuses</option>
                            <option *ngFor="let status of statusOptions" [value]="status">
                                {{ status | titlecase }}
                            </option>
                        </select>
                        <span class="dropdown-arrow"><i class="fas fa-chevron-down" aria-hidden="true"></i></span>
                    </div>
                </div>

                <div class="filter-group">
                    <label for="priority" class="filter-label">Priority</label>
                    <div class="select-container">
                        <select id="priority" [(ngModel)]="filters.priority" name="priority"
                            (ngModelChange)="onFilterChange()" class="filter-select" aria-describedby="priority">
                            <option value="">All Priorities</option>
                            <option *ngFor="let priority of priorityOptions" [value]="priority">
                                {{ priority | titlecase }}
                            </option>
                        </select>
                        <span class="dropdown-arrow"><i class="fas fa-chevron-down" aria-hidden="true"></i></span>
                    </div>
                </div>

                <div class="filter-group">
                    <label for="category" class="filter-label">Category</label>
                    <div class="select-container">
                        <select id="category" [(ngModel)]="filters.category" name="category"
                            (ngModelChange)="onFilterChange()" class="filter-select" aria-describedby="category">
                            <option value="">All Categories</option>
                            <option *ngFor="let category of categoryOptions" [value]="category">
                                {{ category | titlecase }}
                            </option>
                        </select>
                        <span class="dropdown-arrow"><i class="fas fa-chevron-down" aria-hidden="true"></i></span>
                    </div>
                </div>
            </div>

            <div class="filter-row">
                <div class="filter-group">
                    <label for="startDate" class="filter-label">Start Date From</label>
                    <input id="startDate" type="date" class="filter-input" [(ngModel)]="filters.startDateFrom"
                        name="startDate" (ngModelChange)="onFilterChange()" aria-describedby="startDate" />
                </div>

                <div class="filter-group">
                    <label for="endDate" class="filter-label">End Date To</label>
                    <input id="endDate" type="date" class="filter-input" [(ngModel)]="filters.endDateTo" name="endDate"
                        (ngModelChange)="onFilterChange()" aria-describedby="endDate" />
                </div>

                <div class="filter-group">
                    <label class="filter-label checkbox-label">
                        <input type="checkbox" [(ngModel)]="filters.overdueOnly" name="overdueOnly"
                            (ngModelChange)="onFilterChange()" aria-describedby="overdueOnly" />
                        <span class="checkbox-text">Overdue Only</span>
                    </label>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="apply-btn">
                        <span class="btn-icon"><i class="fas fa-search" aria-hidden="true"></i></span>
                        <span class="btn-text">Apply</span>
                    </button>
                    <button type="button" (click)="clearAllFilters()" class="clear-btn">
                        <span class="btn-icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span>
                        <span class="btn-text">Reset</span>
                    </button>
                </div>
            </div>
        </form>

        <div class="date-range-explanation" *ngIf="filters.startDateFrom || filters.endDateTo" role="status">
            <span *ngIf="isDefaultFilter">
                <i class="fas fa-clock" aria-hidden="true"></i> Default: Showing tasks from last 7 days
            </span>
            <span *ngIf="!isDefaultFilter">
                Filtering tasks from
                <strong *ngIf="filters.startDateFrom">{{ filters.startDateFrom | date }}</strong>
                <strong *ngIf="filters.startDateFrom && filters.endDateTo"> to </strong>
                <strong *ngIf="filters.endDateTo">{{ filters.endDateTo | date }}</strong>
            </span>
        </div>
    </div>

    <div class="results-section" aria-label="Task results">
        <div class="stats-bar" *ngIf="filteredData.length > 0" role="region" aria-label="Task statistics">
            <div class="stats-item total">
                <span class="count">{{ counts.total }}</span>
                <span class="label">Total Tasks</span>
            </div>
            <div class="stats-item pending" *ngIf="counts.pending">
                <span class="count">{{ counts.pending }}</span>
                <span class="label">Pending</span>
            </div>
            <div class="stats-item in-progress" *ngIf="counts['in-progress']">
                <span class="count">{{ counts['in-progress'] }}</span>
                <span class="label">In Progress</span>
            </div>
            <div class="stats-item on-hold" *ngIf="counts['on-hold']">
                <span class="count">{{ counts['on-hold'] }}</span>
                <span class="label">On Hold</span>
            </div>
            <div class="stats-item completed" *ngIf="counts['completed']">
                <span class="count">{{ counts['completed'] }}</span>
                <span class="label">Completed</span>
            </div>
        </div>

        <div class="tasks-grid" *ngIf="filteredData.length" role="grid" aria-label="Task list">
            <div *ngFor="let task of filteredData; trackBy: trackByTaskId" class="task-card">
                <div class="task-card-header">
                    <h3>{{ task.title }}</h3>
                    <span class="task-id">#{{ task.id }}</span>
                    <span class="status" [ngClass]="task.status.toLowerCase()">
                        {{ task.status | titlecase }}
                    </span>
                    <span class="priority {{ task.priority | lowercase }}">
                        {{ task.priority | titlecase }}
                    </span>
                    <span *ngIf="task.isOverDue" class="overdue">Overdue</span>
                </div>
                <p>{{ task.description }}</p>
                <div class="task-details">
                    <span>Start: {{ task.startDate | date }}</span>
                    <span>Due: {{ task.dueDate | date }}</span>
                    <span>Category: {{ task.category | titlecase }}</span>
                    <span>by {{ task.createdBy }}</span>
                </div>
                <div class="task-tags" *ngIf="task.tags?.length">
                    <span *ngFor="let tag of task.tags">{{ tag }}</span>
                </div>
            </div>
        </div>

        <div class="no-results" *ngIf="!filteredData.length" role="alert">
            <h2>No tasks found</h2>
        </div>
    </div>
</div>